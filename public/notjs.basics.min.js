(function(){var a,d,b=function(c,g){return function(){return c.apply(g,arguments)}},c=[].slice;d="undefined"!==typeof module&&module.exports?global:window;a=function(){function e(){this.globalNamespace=b(this.globalNamespace,this)}e.prototype.namespace=function(e,a,b){var d,j,k,m,l;3>arguments.length&&(d=[this].concat(c.call(arguments)),e=d[0],a=d[1],b=d[2]);j=e;l=a.split(".");k=0;for(m=l.length;k<m;k++)d=l[k],e=e[d]||(e[d]={});return b(e,j)};e.prototype.globalNamespace=function(){return d};e.prototype.addPrototypeUnlessExists=
function(c,e,a){return c.prototype[e]||(c.prototype[e]=a)};e.prototype.errors={pureVirtualMissing:function(c,e){throw""+c+" pure virtual method "+e+" missing. Must override in subclass of FormInput.";},invalidArgument:function(c){throw"Invalid Argument: "+c;}};return e}.call(this);d.Notjs=new a}).call(this);
(function(){Notjs.addPrototypeUnlessExists(Array,"remove",function(a,d){var b;b=this.slice((d||a)+1||this.length);this.length=0>a?this.length+a:a;return this.push.apply(this,b)});Notjs.addPrototypeUnlessExists(Array,"englishJoin",function(){var a,d;d=this.join(",");a=d.lastIndexOf(",");return 0>=a?d:d.slice(0,+(a-1)+1||9E9)+" and "+d.slice(a+1)})}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};Notjs.namespace("basics",function(d){return d.Form=function(){function b(c,e,b){this.selector=c;this.dataObject=e;null==b&&(b={});this._cancelChanges=a(this._cancelChanges,this);this._commitChanges=a(this._commitChanges,this);this._getClassFor=a(this._getClassFor,this);this._defaultCancelCallback=a(this._defaultCancelCallback,this);this._defaultUpdateCallback=a(this._defaultUpdateCallback,this);this._startInlineEdit=a(this._startInlineEdit,
this);this._findCancelButtons=a(this._findCancelButtons,this);this._findSaveButtons=a(this._findSaveButtons,this);this._focusOnCancel=a(this._focusOnCancel,this);this._focusOnSave=a(this._focusOnSave,this);this._hideSaveAndCancel=a(this._hideSaveAndCancel,this);this._showSaveAndCancel=a(this._showSaveAndCancel,this);this._initializeSaveAndCancel=a(this._initializeSaveAndCancel,this);this._destroyFormInputObject=a(this._destroyFormInputObject,this);this._displayDataFor=a(this._displayDataFor,this);
this._displayDataForAll=a(this._displayDataForAll,this);this._instantiateFormInputFor=a(this._instantiateFormInputFor,this);this._showInputFor=a(this._showInputFor,this);this._showAllInputs=a(this._showAllInputs,this);this._switchToFullInput=a(this._switchToFullInput,this);this._editOnClick=a(this._editOnClick,this);this._removeClickHandlers=a(this._removeClickHandlers,this);this._installClickHandlers=a(this._installClickHandlers,this);this._initializeFormInputs=a(this._initializeFormInputs,this);
this.setFormMode=a(this.setFormMode,this);this.refresh=a(this.refresh,this);this.initialize=a(this.initialize,this);this.options=_.defaults(b,{formMode:"fullInput",updateCallback:this._defaultUpdateCallback,cancelCallback:this._defaultCancelCallback});this.formInputs=[];return this}b.prototype.initialize=function(){this.$element=$(this.selector);this._initializeFormInputs();this._initializeSaveAndCancel();this.setFormMode(this.options.formMode);return this};b.prototype.refresh=function(){return this.setFormMode(this.options.formMode)};
b.prototype.setFormMode=function(c){this.$element.hasClass("readonly")&&(c="readOnly");this.options.formMode=c;this.switchedToFullInput=this.inlineEditing=!1;switch(c){case "fullInput":return this._removeClickHandlers(),this._showAllInputs(),this._showSaveAndCancel();case "inlineEdit":case "fullInputOnClick":return this._displayDataForAll(),this._installClickHandlers(),this._hideSaveAndCancel();case "readOnly":return this._displayDataForAll(),this._removeClickHandlers(),this._hideSaveAndCancel();
default:return Notjs.errors.invalidArgument("formMode")}};b.prototype._initializeFormInputs=function(){var c,e,a,b,f,d;this.formInputs=[];f=this.$element.find("[data-not_attr]");d=[];a=0;for(b=f.length;a<b;a++)c=f[a],c=$(c),e=c.data("not_type")||"Text",d.push(this.formInputs.push({$element:c,type:e,attr:c.data("not_attr"),formInputClass:this._getClassFor(e),formInputObject:null}));return d};b.prototype._installClickHandlers=function(){var c=this;return _.each(this.formInputs,function(e){return e.$element.on("mouseup.notjs-form",
function(){return c._editOnClick(e)})})};b.prototype._removeClickHandlers=function(){var c,e,a,b,f;b=this.formInputs;f=[];e=0;for(a=b.length;e<a;e++)c=b[e],f.push(c.$element.off("mouseup.notjs-form"));return f};b.prototype._editOnClick=function(c){return"fullInputOnClick"===this.options.formMode?this._switchToFullInput():this._startInlineEdit(c)};b.prototype._switchToFullInput=function(){if(!this.switchedToFullInput)return this.switchedToFullInput=!0,this._showAllInputs(),this._showSaveAndCancel()};
b.prototype._showAllInputs=function(){var c,e,a,b,f;b=this.formInputs;f=[];e=0;for(a=b.length;e<a;e++)c=b[e],f.push(this._showInputFor(c));return f};b.prototype._showInputFor=function(c){if(c.$element.hasClass("readonly"))return this._displayDataFor(c);c.formInputObject||(c.$element.html(""),c.formInputObject=this._instantiateFormInputFor(c));return c.formInputObject.loadValue(this.dataObject)};b.prototype._instantiateFormInputFor=function(c){return new c.formInputClass({container:c.$element,column:{field:c.attr},
grid:this,gridPosition:0,position:0,item:dataObject,cancelChanges:this._cancelChanges,commitChanges:this._commitChanges})};b.prototype._displayDataForAll=function(){var c,e,a,b,f;b=this.formInputs;f=[];e=0;for(a=b.length;e<a;e++)c=b[e],f.push(this._displayDataFor(c));return f};b.prototype._displayDataFor=function(c){var e,a,b;e=c.$element;b=c.formInputClass;a=c.attr;if(null!=b.formatForDisplay&&_.isFunction(b.formatForDisplay))return this._destroyFormInputObject(c),e.html(b.formatForDisplay(e,e,this.dataObject[a],
null,this.dataObject));console.warn("FormInput type "+c.type+" for "+a+" doesn't have a formatForDisplay class method. skipping")};b.prototype._destroyFormInputObject=function(c){if(c.formInputObject)return c.formInputObject.destroy(),c.formInputObject=null};b.prototype._initializeSaveAndCancel=function(){this._findSaveButtons().on("click.notjsForm",this._commitChanges);return this._findCancelButtons().on("click.notjsForm",this._cancelChanges)};b.prototype._showSaveAndCancel=function(){this._findSaveButtons().fadeIn();
return this._findCancelButtons().fadeIn()};b.prototype._hideSaveAndCancel=function(){this._findSaveButtons().fadeOut();return this._findCancelButtons().fadeOut()};b.prototype._focusOnSave=function(){return this._findSaveButtons().first().focus()};b.prototype._focusOnCancel=function(){return this._findCancelButtons().first().focus()};b.prototype._findSaveButtons=function(){return this.$element.find("input[type='submit'], .success")};b.prototype._findCancelButtons=function(){return this.$element.find(".cancel")};
b.prototype._startInlineEdit=function(c){if(!c.$element.hasClass("readonly")&&c!==this.inlineEditing)return this.inlineEditing&&this._commitChanges(),this._showInputFor(c),this._showSaveAndCancel(),this.inlineEditing=c};b.prototype._defaultUpdateCallback=function(){};b.prototype._defaultCancelCallback=function(){};b.prototype._getClassFor=function(c){var e,a,b,f,d;if(Notjs.basics.formInputs[c])return Notjs.basics.formInputs[c];e=Notjs.globalNamespace();d=c.split(".");b=0;for(f=d.length;b<f;b++)if(a=
d[b],e[a])e=e[a];else throw"Unable to find class for FormInput type "+c+", specifically "+a;return e};b.prototype._commitChanges=function(){var c,e,a,b,d;this.inlineEditing?(e=[this.inlineEditing],this.inlineEditing=!1):e=this.formInputs;a=[];b=0;for(d=e.length;b<d;b++)c=e[b],null!=c.formInputObject&&(c.formInputObject.applyValue(dataObject,c.formInputObject.serializeValue()),a.push(c.attr));_.defer(this._focusOnSave);this.refresh();return this.options.updateCallback(a)};b.prototype._cancelChanges=
function(){this.inlineEditing=!1;this.refresh();this._focusOnCancel();return this.options.cancelCallback()};return b}()})}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};Notjs.namespace("basics",function(d){return d.FormInput=function(){function b(c){this.args=c;this.bindStandardKeys=a(this.bindStandardKeys,this);this.setDataObjectValue=a(this.setDataObjectValue,this);this.getDataObjectValue=a(this.getDataObjectValue,this);this.focus=a(this.focus,this);this.destroy=a(this.destroy,this);this.applyValue=a(this.applyValue,this);this.serializeValue=a(this.serializeValue,this);this.loadValue=
a(this.loadValue,this);this.initialize=a(this.initialize,this);this.$element=this.args.container;this.attr=this.args.column.field;this.options=this.args.column;c=this.initialize();this.bindStandardKeys(c);return c}b.formatForDisplay=function(){return Notjs.errors.pureVirtualMissing("FormInput","@formatForDisplay")};b.prototype.initialize=function(){return Notjs.errors.pureVirtualMissing("FormInput","initialize")};b.prototype.loadValue=function(){return Notjs.errors.pureVirtualMissing("FormInput",
"loadValue")};b.prototype.serializeValue=function(){return Notjs.errors.pureVirtualMissing("FormInput","serializeValue")};b.prototype.applyValue=function(c,a){return this.setDataObjectValue(c,a)};b.prototype.destroy=function(){return this.$element.html("")};b.prototype.focus=function(){return this.$element.focus()};b.prototype.getDataObjectValue=function(c){return Notjs.deepGet(c,this.attr)||""};b.prototype.setDataObjectValue=function(c,a){return Notjs.deepSet(c,this.attr,a)};b.prototype.bindStandardKeys=
function(c){var a=this;return c.on("keydown.notjsFormInput",function(c){switch(c.keyCode){case Notjs.keyCode.ENTER:return a.args.commitChanges();case Notjs.keyCode.ESCAPE:return a.args.cancelChanges()}})};return b}.call(this)})}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};Notjs.namespace("basics",function(d){return d.Partials=function(){function b(c){null==c&&(c={});this.onPartialsResolved=a(this.onPartialsResolved,this);this.onPartialRendered=a(this.onPartialRendered,this);this.renderPartial=a(this.renderPartial,this);this.fetchExternalPartial=a(this.fetchExternalPartial,this);this.resolveExternal=a(this.resolveExternal,this);this.resolveInPage=a(this.resolveInPage,this);this.resolve=
a(this.resolve,this);this.initialize=a(this.initialize,this);this.options=_.defaults(c,{removePartials:!0,hidePartials:!1,selector:"body",onPartialsResolved:null,onPartialRendered:null});this.inPagePartials={};this.outstandingExternalRequests=0}b.resolve=function(c){null==c&&(c={});return(new this(c)).initialize().resolve()};b.prototype.initialize=function(){var c;this.$el=$(this.options.selector);c=this.$el.find(".not-partial");this.inPagePartials=_.groupBy(c,"id");this.options.removePartials&&c.remove();
this.options.hidePartials&&c.hide();return this};b.prototype.resolve=function(c){var a=this;null==c&&(c={});c=_.defaults(c,{onPartialsResolved:null});this.resolveExternal({onComplete:function(){a.resolveInPage();return a.onPartialsResolved(c.onPartialsResolved)}});return this};b.prototype.resolveInPage=function(){var c,a,b,d,f,i,j;a=this.$el.find('[data-not_partial^="#"]');f=0;for(i=a.length;f<i;f++)c=a[f],c=$(c),b=c.attr("data-not_partial"),d=b.slice(1),(b=null!=(j=this.inPagePartials[d])?j[0]:void 0)?
this.renderPartial(c,$(b).html()):console.error("In page partial not found by id "+d+" for element: ");return this};b.prototype.resolveExternal=function(c){var a,b,d,f,i;null==c&&(c={});c=_.defaults(c,{onComplete:null});this.externalsRes;b=this.$el.find('[data-not_partial*="/"]');if(0>=b.length&&"function"===typeof c.onComplete)c.onComplete();f=0;for(i=b.length;f<i;f++)a=b[f],a=$(a),d=a.attr("data-not_partial"),this.fetchExternalPartial(a,d,c);return this};b.prototype.fetchExternalPartial=function(c,
a,b){var d=this;null==b&&(b={});b=_.defaults(b,{onComplete:null});if(!a.isBlank())return this.outstandingExternalRequests+=1,$.ajax(a,{dataType:"html",complete:function(){if(0>=(d.outstandingExternalRequests-=1))return"function"===typeof b.onComplete?b.onComplete():void 0},success:function(a){return d.renderPartial(c,a)},error:function(c,b,d){return console.log("Notjs.basics.Partial: Failed to fetch external partial at "+a+". "+("error: "+d+". status: "+status))}})};b.prototype.renderPartial=function(c,
a){c.html(a);return this.onPartialRendered(c)};b.prototype.onPartialRendered=function(c){var a;return"function"===typeof(a=this.options).onPartialRendered?a.onPartialRendered(c):void 0};b.prototype.onPartialsResolved=function(c){var a;return("function"===typeof c?c():void 0)||("function"===typeof(a=this.options).onPartialsResolved?a.onPartialsResolved():void 0)};return b}()})}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};Notjs.namespace("basics",function(d){return d.Replicator=function(){function b(c,b){this.selector=c;null==b&&(b={});this.replicate=a(this.replicate,this);this.getTemplate=a(this.getTemplate,this);this.initialize=a(this.initialize,this);this.options=_.defaults(b,{data:null})}b.replicate=function(c,a,d){return(new b(c)).initialize().replicate(a,d)};b.prototype.initialize=function(){this.$element=$(this.selector);this.getTemplate();
return this};b.prototype.getTemplate=function(){if(this.$template)return this.$template;this.$template=this.$element.clone();this.$element.html("");return this.$template};b.prototype.replicate=function(c,a){var b,d,f,i,j;this.$element.html("");f=i=0;for(j=c.length;i<j;f=++i)d=c[f],b=this.$template.clone(),(!a||a(b,d,f))&&this.$element.append(b);return this};return b}.call(this)})}).call(this);
(function(){Notjs.addPrototypeUnlessExists(String,"startsWith",function(a){return this.slice(0,a.length)===a});Notjs.addPrototypeUnlessExists(String,"endsWith",function(a){return this.slice(-a.length)===str});Notjs.addPrototypeUnlessExists(String,"isBlank",function(){return""===this.trim()});Notjs.addPrototypeUnlessExists(String,"trim",function(){return this.replace(/^\s+|\s+$/g,"")});Notjs.addPrototypeUnlessExists(String,"elipsize",function(a){return this.length<=a?this:this.slice(0,a-3)+"..."});
Notjs.addPrototypeUnlessExists(String,"decamelize",function(){var a;a=this.replace(/([A-Z])/g," $1");return a.charAt(0).toUpperCase()+a.slice(1)});Notjs.addPrototypeUnlessExists(String,"dropCamelize",function(){var a;a=this.replace(/\s/g,"");return a.charAt(0).toLowerCase()+a.slice(1)})}).call(this);
(function(){Notjs.deepGet=function(a,d){var b,c,e,g,h;b=a;h=d.split(".");e=0;for(g=h.length;e<g;e++){c=h[e];if(null==b[c]){b=null;break}b=_.isFunction(b[c])?b[c]():b[c]}return b};Notjs.deepSet=function(a,d,b){var c,e,g,h;e=d.split(".");d=_.last(e);g=0;for(h=e.length;g<h;g++){c=e[g];if(null==a[c]){a=null;break}if(c===d)return _.isFunction(a[c])?a[c](b):a[c]=b}return a};Notjs.keyCode={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,
DELETE:46}}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,b=function(a,b){function g(){this.constructor=a}for(var h in b)d.call(b,h)&&(a[h]=b[h]);g.prototype=b.prototype;a.prototype=new g;a.__super__=b.prototype;return a};Notjs.namespace("basics.formInputs",function(c){return c.Checkbox=function(e){function d(c){this.serializeValue=a(this.serializeValue,this);this.loadValue=a(this.loadValue,this);this.initialize=a(this.initialize,this);d.__super__.constructor.apply(this,
arguments)}b(d,e);d.formatForDisplay=function(a,c,b){return b?"Yes":"No"};d.prototype.initialize=function(){return this.$input=$(c.Checkbox._renderInput(!1,!1)).appendTo(this.$element).focus().select()};d.prototype.loadValue=function(a){return this.getDataObjectValue(a)?this.$input.attr("checked","checked"):this.$input.removeAttr("checked")};d.prototype.serializeValue=function(){return"checked"===this.$input.attr("checked")};d._renderInput=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return"<input type='checkbox' "+
(c?"disabled='disabled'":"")+" "+(a?"checked='checked'":"")+"/>"};return d}.call(this,Notjs.basics.FormInput)})}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,b=function(a,b){function g(){this.constructor=a}for(var h in b)d.call(b,h)&&(a[h]=b[h]);g.prototype=b.prototype;a.prototype=new g;a.__super__=b.prototype;return a};Notjs.namespace("basics.formInputs",function(c){return c.Text=function(c){function d(b){this.serializeValue=a(this.serializeValue,this);this.loadValue=a(this.loadValue,this);this.destroy=a(this.destroy,this);this.initialize=a(this.initialize,
this);d.__super__.constructor.apply(this,arguments)}b(d,c);d.formatForDisplay=function(a,b,c){return null!=c?c.toString():void 0};d.prototype.initialize=function(){var a=this;this.$input=$("<INPUT type=text/>").appendTo(this.$element).on("keydown.nav",function(a){if(a.keyCode===Notjs.keyCode.LEFT||a.keyCode===Notjs.keyCode.RIGHT)return a.stopImmediatePropagation()});_.defer(function(){return a.$input.focus().select()});return this.$input};d.prototype.destroy=function(){return this.$input.remove()};
d.prototype.loadValue=function(a){return this.$input.val(this.getDataObjectValue(a))};d.prototype.serializeValue=function(){return this.$input.val()};return d}.call(this,Notjs.basics.FormInput)})}).call(this);
