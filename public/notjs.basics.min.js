(function(){var a,d,b=function(c,f){return function(){return c.apply(f,arguments)}},c=[].slice;d="undefined"!==typeof module&&module.exports?global:window;a=function(){function e(){this.globalNamespace=b(this.globalNamespace,this)}e.prototype.namespace=function(e,a,b){var d,j,k,m,l;3>arguments.length&&(d=[this].concat(c.call(arguments)),e=d[0],a=d[1],b=d[2]);j=e;l=a.split(".");k=0;for(m=l.length;k<m;k++)d=l[k],e=e[d]||(e[d]={});return b(e,j)};e.prototype.globalNamespace=function(){return d};e.prototype.addPrototypeUnlessExists=
function(c,e,a){return c.prototype[e]||(c.prototype[e]=a)};e.prototype.errors={pureVirtualMissing:function(c,e){throw""+c+" pure virtual method "+e+" missing. Must override in subclass of FormInput.";},invalidArgument:function(c){throw"Invalid Argument: "+c;}};return e}.call(this);d.Notjs=new a}).call(this);
(function(){Notjs.addPrototypeUnlessExists(Array,"remove",function(a,d){var b;b=this.slice((d||a)+1||this.length);this.length=0>a?this.length+a:a;return this.push.apply(this,b)});Notjs.addPrototypeUnlessExists(Array,"englishJoin",function(){var a,d;d=this.join(",");a=d.lastIndexOf(",");return 0>=a?d:d.slice(0,+(a-1)+1||9E9)+" and "+d.slice(a+1)})}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};Notjs.namespace("basics",function(d){return d.Form=function(){function b(c,e,f){this.selector=c;this.dataObject=e;null==f&&(f={});this._cancelChanges=a(this._cancelChanges,this);this._commitChanges=a(this._commitChanges,this);this._getClassFor=a(this._getClassFor,this);this._defaultUpdateCallback=a(this._defaultUpdateCallback,this);this._startInlineEdit=a(this._startInlineEdit,this);this._findCancelButtons=a(this._findCancelButtons,
this);this._findSaveButtons=a(this._findSaveButtons,this);this._hideSaveAndCancel=a(this._hideSaveAndCancel,this);this._showSaveAndCancel=a(this._showSaveAndCancel,this);this._displayDataFor=a(this._displayDataFor,this);this._displayDataForAll=a(this._displayDataForAll,this);this._instantiateFormInputFor=a(this._instantiateFormInputFor,this);this._showInputFor=a(this._showInputFor,this);this._showAllInputs=a(this._showAllInputs,this);this._editOnClick=a(this._editOnClick,this);this._installClickHandlers=
a(this._installClickHandlers,this);this._initializeFormInputs=a(this._initializeFormInputs,this);this.setFormMode=a(this.setFormMode,this);this.refresh=a(this.refresh,this);this.initialize=a(this.initialize,this);this.options=_.defaults(f,{formMode:"fullInput",updateCallback:this._defaultUpdateCallback});this.formInputs=[];return this}b.prototype.initialize=function(){this.$element=$(this.selector);this._initializeFormInputs();this.setFormMode(this.options.formMode);return this};b.prototype.refresh=
function(){return this.setFormMode(this.options.formMode)};b.prototype.setFormMode=function(c){this.$element.hasClass("readonly")&&(c="readOnly");this.options.formMode=c;this.inlineEditing=!1;switch(c){case "fullInput":return this._showAllInputs(),this._showSaveAndCancel();case "inlineEdit":case "fullInputOnClick":return this._displayDataForAll(),this._installClickHandlers(),this._hideSaveAndCancel();case "readOnly":return this._displayDataForAll(),this._hideSaveAndCancel();default:return Notjs.errors.invalidArgument("formMode")}};
b.prototype._initializeFormInputs=function(){var c,e,a,b,g,d;this.formInputs=[];g=this.$element.find("[data-not_attr]");d=[];a=0;for(b=g.length;a<b;a++)c=g[a],c=$(c),e=c.data("not_type")||"Text",d.push(this.formInputs.push({$element:c,type:e,attr:c.data("not_attr"),formInputClass:this._getClassFor(e),formInputObject:null}));return d};b.prototype._installClickHandlers=function(){var c,e,a,b,d,i=this;b=this.formInputs;d=[];e=0;for(a=b.length;e<a;e++)c=b[e],d.push(c.$element.click(function(){return i._editOnClick(c)}));
return d};b.prototype._editOnClick=function(c){"fullInputOnClick"===this.options.formMode?this._showAllInputs():this._startInlineEdit(c);return c.$element.focus().select()};b.prototype._showAllInputs=function(){var c,e,a,b,d;b=this.formInputs;d=[];e=0;for(a=b.length;e<a;e++)c=b[e],d.push(this._showInputFor(c));return d};b.prototype._showInputFor=function(c){if(c.$element.hasClass("readonly"))return this._displayDataFor(c);c.formInputObject||(c.formInputObject=this._instantiateFormInputFor(c));return c.formInputObject.loadValue(this.dataObject)};
b.prototype._instantiateFormInputFor=function(c){return new c.formInputClass({container:c.$element,column:{field:c.attr},grid:this,gridPosition:0,position:0,item:dataObject,cancelChanges:this._cancelChanges,commitChanges:this._commitChanges})};b.prototype._displayDataForAll=function(){var c,e,a,b,d;b=this.formInputs;d=[];e=0;for(a=b.length;e<a;e++)c=b[e],d.push(this._displayDataFor(c));return d};b.prototype._displayDataFor=function(c){var e,a,b;e=c.$element;b=c.formInputClass;a=c.attr;if(null!=b.formatForDisplay&&
_.isFunction(b.formatForDisplay))return e.html(b.formatForDisplay(e,e,this.dataObject[a],null,this.dataObject));console.warn("FormInput type "+c.type+" for "+a+" doesn't have a formatForDisplay class method. skipping")};b.prototype._showSaveAndCancel=function(){this._findSaveButtons().removeClass("hidden").on("click.notjs-form",this._commitChanges);return this._findCancelButtons().removeClass("hidden").on("click.notjs-form",this._cancelChanges)};b.prototype._hideSaveAndCancel=function(){this._findSaveButtons().addClass("hidden").off("click.notjs-form");
return this._findCancelButtons().addClass("hidden").off("click.notjs-form")};b.prototype._findSaveButtons=function(){return this.$element.find("input[type='submit'], .success")};b.prototype._findCancelButtons=function(){return this.$element.find(".cancel")};b.prototype._startInlineEdit=function(c){if(!c.$element.hasClass("readonly"))return this._showInputFor(c),this._showSaveAndCancel(),this.inlineEditing=c};b.prototype._defaultUpdateCallback=function(){};b.prototype._getClassFor=function(c){var e,
a,b,d,i;if(Notjs.basics.formInputs[c])return Notjs.basics.formInputs[c];e=Notjs.globalNamespace();i=c.split(".");b=0;for(d=i.length;b<d;b++)if(a=i[b],e[a])e=e[a];else throw"Unable to find class for FormInput type "+c+", specifically "+a;return e};b.prototype._commitChanges=function(){var c,e,a,b,d;this.inlineEditing?(e=[this.inlineEditing],this.inlineEditing=!1):e=this.formInputs;a=[];b=0;for(d=e.length;b<d;b++)c=e[b],null!=c.formInputObject&&(c.formInputObject.applyValue(dataObject,c.formInputObject.serializeValue()),
a.push(c.attr));return this.options.updateCallback(a)};b.prototype._cancelChanges=function(){this.inlineEditing=!1;return this.refresh()};return b}()})}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};Notjs.namespace("basics",function(d){return d.FormInput=function(){function b(c){this.args=c;this.setDataObjectValue=a(this.setDataObjectValue,this);this.getDataObjectValue=a(this.getDataObjectValue,this);this.focus=a(this.focus,this);this.destroy=a(this.destroy,this);this.applyValue=a(this.applyValue,this);this.serializeValue=a(this.serializeValue,this);this.loadValue=a(this.loadValue,this);this.initialize=a(this.initialize,
this);this.$element=this.args.container;this.attr=this.args.column.field;this.options=this.args.column;return this.initialize()}b.formatForDisplay=function(){return Notjs.errors.pureVirtualMissing("FormInput","@formatForDisplay")};b.prototype.initialize=function(){return Notjs.errors.pureVirtualMissing("FormInput","initialize")};b.prototype.loadValue=function(){return Notjs.errors.pureVirtualMissing("FormInput","loadValue")};b.prototype.serializeValue=function(){return Notjs.errors.pureVirtualMissing("FormInput",
"serializeValue")};b.prototype.applyValue=function(c,a){return this.setDataObjectValue(c,a)};b.prototype.destroy=function(){return this.$element.html("")};b.prototype.focus=function(){return this.$element.focus()};b.prototype.getDataObjectValue=function(c){return Notjs.deepGet(c,this.attr)||""};b.prototype.setDataObjectValue=function(c,a){return Notjs.deepSet(c,this.attr,a)};return b}.call(this)})}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};Notjs.namespace("basics",function(d){return d.Partials=function(){function b(c){null==c&&(c={});this.onPartialsResolved=a(this.onPartialsResolved,this);this.onPartialRendered=a(this.onPartialRendered,this);this.renderPartial=a(this.renderPartial,this);this.fetchExternalPartial=a(this.fetchExternalPartial,this);this.resolveExternal=a(this.resolveExternal,this);this.resolveInPage=a(this.resolveInPage,this);this.resolve=
a(this.resolve,this);this.initialize=a(this.initialize,this);this.options=_.defaults(c,{removePartials:!0,hidePartials:!1,selector:"body",onPartialsResolved:null,onPartialRendered:null});this.inPagePartials={};this.outstandingExternalRequests=0}b.resolve=function(c){null==c&&(c={});return(new this(c)).initialize().resolve()};b.prototype.initialize=function(){var c;this.$el=$(this.options.selector);c=this.$el.find(".not-partial");this.inPagePartials=_.groupBy(c,"id");this.options.removePartials&&c.remove();
this.options.hidePartials&&c.hide();return this};b.prototype.resolve=function(c){var a=this;null==c&&(c={});c=_.defaults(c,{onPartialsResolved:null});this.resolveExternal({onComplete:function(){a.resolveInPage();return a.onPartialsResolved(c.onPartialsResolved)}});return this};b.prototype.resolveInPage=function(){var c,a,b,d,g,i,j;a=this.$el.find('[data-not_partial^="#"]');g=0;for(i=a.length;g<i;g++)c=a[g],c=$(c),b=c.attr("data-not_partial"),d=b.slice(1),(b=null!=(j=this.inPagePartials[d])?j[0]:void 0)?
this.renderPartial(c,$(b).html()):console.error("In page partial not found by id "+d+" for element: ");return this};b.prototype.resolveExternal=function(c){var a,b,d,g,i;null==c&&(c={});c=_.defaults(c,{onComplete:null});this.externalsRes;b=this.$el.find('[data-not_partial*="/"]');if(0>=b.length&&"function"===typeof c.onComplete)c.onComplete();g=0;for(i=b.length;g<i;g++)a=b[g],a=$(a),d=a.attr("data-not_partial"),this.fetchExternalPartial(a,d,c);return this};b.prototype.fetchExternalPartial=function(c,
a,b){var d=this;null==b&&(b={});b=_.defaults(b,{onComplete:null});if(!a.isBlank())return this.outstandingExternalRequests+=1,$.ajax(a,{dataType:"html",complete:function(){if(0>=(d.outstandingExternalRequests-=1))return"function"===typeof b.onComplete?b.onComplete():void 0},success:function(a){return d.renderPartial(c,a)},error:function(c,b,d){return console.log("Notjs.basics.Partial: Failed to fetch external partial at "+a+". "+("error: "+d+". status: "+status))}})};b.prototype.renderPartial=function(c,
a){c.html(a);return this.onPartialRendered(c)};b.prototype.onPartialRendered=function(c){var a;return"function"===typeof(a=this.options).onPartialRendered?a.onPartialRendered(c):void 0};b.prototype.onPartialsResolved=function(c){var a;return("function"===typeof c?c():void 0)||("function"===typeof(a=this.options).onPartialsResolved?a.onPartialsResolved():void 0)};return b}()})}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};Notjs.namespace("basics",function(d){return d.Replicator=function(){function b(c,b){this.selector=c;null==b&&(b={});this.replicate=a(this.replicate,this);this.getTemplate=a(this.getTemplate,this);this.initialize=a(this.initialize,this);this.options=_.defaults(b,{data:null})}b.replicate=function(c,a,d){return(new b(c)).initialize().replicate(a,d)};b.prototype.initialize=function(){this.$element=$(this.selector);this.getTemplate();
return this};b.prototype.getTemplate=function(){if(this.$template)return this.$template;this.$template=this.$element.clone();this.$element.html("");return this.$template};b.prototype.replicate=function(a,b){var d,h,g,i,j;this.$element.html("");g=i=0;for(j=a.length;i<j;g=++i)h=a[g],d=this.$template.clone(),(!b||b(d,h,g))&&this.$element.append(d);return this};return b}.call(this)})}).call(this);
(function(){Notjs.addPrototypeUnlessExists(String,"startsWith",function(a){return this.slice(0,a.length)===a});Notjs.addPrototypeUnlessExists(String,"endsWith",function(a){return this.slice(-a.length)===str});Notjs.addPrototypeUnlessExists(String,"isBlank",function(){return""===this.trim()});Notjs.addPrototypeUnlessExists(String,"trim",function(){return this.replace(/^\s+|\s+$/g,"")});Notjs.addPrototypeUnlessExists(String,"elipsize",function(a){return this.length<=a?this:this.slice(0,a-3)+"..."});
Notjs.addPrototypeUnlessExists(String,"decamelize",function(){var a;a=this.replace(/([A-Z])/g," $1");return a.charAt(0).toUpperCase()+a.slice(1)});Notjs.addPrototypeUnlessExists(String,"dropCamelize",function(){var a;a=this.replace(/\s/g,"");return a.charAt(0).toLowerCase()+a.slice(1)})}).call(this);
(function(){Notjs.deepGet=function(a,d){var b,c,e,f,h;b=a;h=d.split(".");e=0;for(f=h.length;e<f;e++){c=h[e];if(null==b[c]){b=null;break}b=_.isFunction(b[c])?b[c]():b[c]}return b};Notjs.deepSet=function(a,d,b){var c,e,f,h;e=d.split(".");d=_.last(e);f=0;for(h=e.length;f<h;f++){c=e[f];if(null==a[c]){a=null;break}if(c===d)return _.isFunction(a[c])?a[c](b):a[c]=b}return a};Notjs.keyCode={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,
DELETE:46}}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,b=function(a,b){function f(){this.constructor=a}for(var h in b)d.call(b,h)&&(a[h]=b[h]);f.prototype=b.prototype;a.prototype=new f;a.__super__=b.prototype;return a};Notjs.namespace("basics.formInputs",function(c){return c.Checkbox=function(d){function f(c){this.serializeValue=a(this.serializeValue,this);this.loadValue=a(this.loadValue,this);this.initialize=a(this.initialize,this);f.__super__.constructor.apply(this,
arguments)}b(f,d);f.formatForDisplay=function(a,c,b){return f._renderInput(b,!0)};f.prototype.initialize=function(){return this.$input=$(c.Checkbox._renderInput(!1,!1)).appendTo(this.$element).focus().select()};f.prototype.loadValue=function(a){return this.getDataObjectValue(a)?this.$input.attr("checked","checked"):this.$input.removeAttr("checked")};f.prototype.serializeValue=function(){return"checked"===this.$input.attr("checked")};f._renderInput=function(a,c){null==a&&(a=!1);null==c&&(c=!1);return"<input type='checkbox' "+
(c?"disabled='disabled'":"")+" "+(a?"checked='checked'":"")+"/>"};return f}.call(this,Notjs.basics.FormInput)})}).call(this);
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,b=function(a,b){function f(){this.constructor=a}for(var h in b)d.call(b,h)&&(a[h]=b[h]);f.prototype=b.prototype;a.prototype=new f;a.__super__=b.prototype;return a};Notjs.namespace("basics.formInputs",function(c){return c.Text=function(c){function d(b){this.serializeValue=a(this.serializeValue,this);this.loadValue=a(this.loadValue,this);this.initialize=a(this.initialize,this);d.__super__.constructor.apply(this,
arguments)}b(d,c);d.formatForDisplay=function(a,b,c){return null!=c?c.toString():void 0};d.prototype.initialize=function(){return this.$input=$("<INPUT type=text/>").appendTo(this.$element).bind("keydown.nav",function(a){if(a.keyCode===Notjs.keyCode.LEFT||a.keyCode===Notjs.keyCode.RIGHT)return a.stopImmediatePropagation()}).focus().select()};d.prototype.loadValue=function(a){return this.$input.val(this.getDataObjectValue(a))};d.prototype.serializeValue=function(){return this.$input.val()};return d}.call(this,
Notjs.basics.FormInput)})}).call(this);
