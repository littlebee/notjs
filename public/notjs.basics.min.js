(function(){var a,d,c=function(b,g){return function(){return b.apply(g,arguments)}},b=[].slice;d="undefined"!==typeof module&&module.exports?global:window;a=function(){function e(){this.globalNamespace=c(this.globalNamespace,this)}e.prototype.namespace=function(e,a,c){var d,j,k,m,l;3>arguments.length&&(d=[this].concat(b.call(arguments)),e=d[0],a=d[1],c=d[2]);j=e;l=a.split(".");k=0;for(m=l.length;k<m;k++)d=l[k],e=e[d]||(e[d]={});return c(e,j)};e.prototype.globalNamespace=function(){return d};e.prototype.addPrototypeUnlessExists=
function(b,e,a){return b.prototype[e]||(b.prototype[e]=a)};e.prototype.errors={pureVirtualMissing:function(b,e){throw""+b+" pure virtual method "+e+" missing. Must override in subclass of FormInput.";},invalidArgument:function(b){throw"Invalid Argument: "+b;},selectorNotFound:function(b){throw"Notjs:  selector not found "+b.toString();}};return e}.call(this);d.Notjs=new a}).call(this);
(function(){Notjs.addPrototypeUnlessExists(Array,"remove",function(a,d){var c;c=this.slice((d||a)+1||this.length);this.length=0>a?this.length+a:a;return this.push.apply(this,c)});Notjs.addPrototypeUnlessExists(Array,"englishJoin",function(){var a,d;d=this.join(",");a=d.lastIndexOf(",");return 0>=a?d:d.slice(0,+(a-1)+1||9E9)+" and "+d.slice(a+1)})}).call(this);
(function(){var a=function(a,c){return function(){return a.apply(c,arguments)}};Notjs.namespace("basics",function(d){return d.Form=function(){function c(b,e,c){this.selector=b;this.dataObject=e;null==c&&(c={});this._cancelChanges=a(this._cancelChanges,this);this._commitChanges=a(this._commitChanges,this);this._getClassFor=a(this._getClassFor,this);this._defaultCancelCallback=a(this._defaultCancelCallback,this);this._defaultUpdateCallback=a(this._defaultUpdateCallback,this);this._startInlineEdit=a(this._startInlineEdit,
this);this._findCancelButtons=a(this._findCancelButtons,this);this._findSaveButtons=a(this._findSaveButtons,this);this._focusOnCancel=a(this._focusOnCancel,this);this._focusOnSave=a(this._focusOnSave,this);this._hideSaveAndCancel=a(this._hideSaveAndCancel,this);this._showSaveAndCancel=a(this._showSaveAndCancel,this);this._initializeSaveAndCancel=a(this._initializeSaveAndCancel,this);this._destroyFormInputObject=a(this._destroyFormInputObject,this);this._displayDataFor=a(this._displayDataFor,this);
this._displayDataForAll=a(this._displayDataForAll,this);this._instantiateFormInputFor=a(this._instantiateFormInputFor,this);this._showInputFor=a(this._showInputFor,this);this._showAllInputs=a(this._showAllInputs,this);this._switchToFullInput=a(this._switchToFullInput,this);this._editOnClick=a(this._editOnClick,this);this._removeClickHandlers=a(this._removeClickHandlers,this);this._installClickHandlers=a(this._installClickHandlers,this);this._initializeFormInputs=a(this._initializeFormInputs,this);
this.setFormMode=a(this.setFormMode,this);this.refresh=a(this.refresh,this);this.initialize=a(this.initialize,this);this.options=_.defaults(c,{formMode:"fullInput",updateCallback:this._defaultUpdateCallback,cancelCallback:this._defaultCancelCallback});this.formInputs=[];return this}c.prototype.initialize=function(){this.$element=$(this.selector);0>=this.$element.length&&Notjs.errors.selectorNotFound(this.selector);this._initializeFormInputs();this._initializeSaveAndCancel();this.setFormMode(this.options.formMode);
return this};c.prototype.refresh=function(){return this.setFormMode(this.options.formMode)};c.prototype.setFormMode=function(b){this.$element.hasClass("readonly")&&(b="readOnly");this.options.formMode=b;this.switchedToFullInput=this.inlineEditing=!1;switch(b){case "fullInput":return this._removeClickHandlers(),this._showAllInputs(),this._showSaveAndCancel();case "inlineEdit":case "fullInputOnClick":return this._displayDataForAll(),this._installClickHandlers(),this._hideSaveAndCancel();case "readOnly":return this._displayDataForAll(),
this._removeClickHandlers(),this._hideSaveAndCancel();default:return Notjs.errors.invalidArgument("formMode")}};c.prototype._initializeFormInputs=function(){var b,e,a,c,f,d;this.formInputs=[];f=this.$element.find("[data-not_attr]");d=[];a=0;for(c=f.length;a<c;a++)b=f[a],b=$(b),e=b.data("not_type")||"Text",d.push(this.formInputs.push({$element:b,type:e,attr:b.data("not_attr"),formInputClass:this._getClassFor(e),formInputObject:null}));return d};c.prototype._installClickHandlers=function(){var b=this;
return _.each(this.formInputs,function(e){return e.$element.on("mouseup.notjs-form",function(){return b._editOnClick(e)})})};c.prototype._removeClickHandlers=function(){var b,e,a,c,f;c=this.formInputs;f=[];e=0;for(a=c.length;e<a;e++)b=c[e],f.push(b.$element.off("mouseup.notjs-form"));return f};c.prototype._editOnClick=function(b){return"fullInputOnClick"===this.options.formMode?this._switchToFullInput():this._startInlineEdit(b)};c.prototype._switchToFullInput=function(){if(!this.switchedToFullInput)return this.switchedToFullInput=
!0,this._showAllInputs(),this._showSaveAndCancel()};c.prototype._showAllInputs=function(){var b,e,a,c,f;c=this.formInputs;f=[];e=0;for(a=c.length;e<a;e++)b=c[e],f.push(this._showInputFor(b));return f};c.prototype._showInputFor=function(b){if(b.$element.hasClass("readonly"))return this._displayDataFor(b);b.formInputObject||(b.$element.html(""),b.formInputObject=this._instantiateFormInputFor(b));return b.formInputObject.loadValue(this.dataObject)};c.prototype._instantiateFormInputFor=function(b){return new b.formInputClass({container:b.$element,
column:{field:b.attr},grid:this,gridPosition:0,position:0,item:this.dataObject,cancelChanges:this._cancelChanges,commitChanges:this._commitChanges})};c.prototype._displayDataForAll=function(){var b,e,a,c,f;c=this.formInputs;f=[];e=0;for(a=c.length;e<a;e++)b=c[e],f.push(this._displayDataFor(b));return f};c.prototype._displayDataFor=function(b){var e,a,c;e=b.$element;c=b.formInputClass;a=b.attr;if(null!=c.formatForDisplay&&_.isFunction(c.formatForDisplay))return this._destroyFormInputObject(b),e.html(c.formatForDisplay(e,
e,this.dataObject[a],null,this.dataObject));console.warn("FormInput type "+b.type+" for "+a+" doesn't have a formatForDisplay class method. skipping")};c.prototype._destroyFormInputObject=function(b){if(b.formInputObject)return b.formInputObject.destroy(),b.formInputObject=null};c.prototype._initializeSaveAndCancel=function(){this._findSaveButtons().on("click.notjsForm",this._commitChanges);return this._findCancelButtons().on("click.notjsForm",this._cancelChanges)};c.prototype._showSaveAndCancel=
function(){this._findSaveButtons().delay(0).fadeIn();return this._findCancelButtons().delay(0).fadeIn()};c.prototype._hideSaveAndCancel=function(){this._findSaveButtons().delay(0).fadeOut();return this._findCancelButtons().delay(0).fadeOut()};c.prototype._focusOnSave=function(){return this._findSaveButtons().first().focus()};c.prototype._focusOnCancel=function(){return this._findCancelButtons().first().focus()};c.prototype._findSaveButtons=function(){return this.$element.find("input[type='submit'], .success")};
c.prototype._findCancelButtons=function(){return this.$element.find(".cancel")};c.prototype._startInlineEdit=function(b){if(!b.$element.hasClass("readonly")&&b!==this.inlineEditing)return this.inlineEditing&&this._commitChanges(),this._showInputFor(b),this._showSaveAndCancel(),this.inlineEditing=b};c.prototype._defaultUpdateCallback=function(){};c.prototype._defaultCancelCallback=function(){};c.prototype._getClassFor=function(b){var e,a,c,f,d;if(Notjs.basics.formInputs[b])return Notjs.basics.formInputs[b];
e=Notjs.globalNamespace();d=b.split(".");c=0;for(f=d.length;c<f;c++)if(a=d[c],e[a])e=e[a];else throw"Unable to find class for FormInput type "+b+", specifically "+a;return e};c.prototype._commitChanges=function(){var b,e,a,c,d;this.inlineEditing?(e=[this.inlineEditing],this.inlineEditing=!1):e=this.formInputs;a=[];c=0;for(d=e.length;c<d;c++)b=e[c],null!=b.formInputObject&&(b.formInputObject.applyValue(this.dataObject,b.formInputObject.serializeValue()),a.push(b.attr));_.defer(this._focusOnSave);this.options.updateCallback(a);
return this.refresh()};c.prototype._cancelChanges=function(){this.inlineEditing=!1;this.refresh();this._focusOnCancel();return this.options.cancelCallback()};return c}()})}).call(this);
(function(){var a=function(a,c){return function(){return a.apply(c,arguments)}};Notjs.namespace("basics",function(d){return d.FormInput=function(){function c(b){this.args=b;this.bindStandardKeys=a(this.bindStandardKeys,this);this.setDataObjectValue=a(this.setDataObjectValue,this);this.getDataObjectValue=a(this.getDataObjectValue,this);this.focus=a(this.focus,this);this.destroy=a(this.destroy,this);this.applyValue=a(this.applyValue,this);this.serializeValue=a(this.serializeValue,this);this.loadValue=
a(this.loadValue,this);this.initialize=a(this.initialize,this);this.$element=this.args.container;this.attr=this.args.column.field;this.options=this.args.column;b=this.initialize();this.bindStandardKeys(b);return b}c.formatForDisplay=function(){return Notjs.errors.pureVirtualMissing("FormInput","@formatForDisplay")};c.prototype.initialize=function(){return Notjs.errors.pureVirtualMissing("FormInput","initialize")};c.prototype.loadValue=function(){return Notjs.errors.pureVirtualMissing("FormInput",
"loadValue")};c.prototype.serializeValue=function(){return Notjs.errors.pureVirtualMissing("FormInput","serializeValue")};c.prototype.applyValue=function(b,a){return this.setDataObjectValue(b,a)};c.prototype.destroy=function(){return this.$element.html("")};c.prototype.focus=function(){return this.$element.focus()};c.prototype.getDataObjectValue=function(b){return Notjs.deepGet(b,this.attr)||""};c.prototype.setDataObjectValue=function(b,a){return Notjs.deepSet(b,this.attr,a)};c.prototype.bindStandardKeys=
function(b){var a=this;return b.on("keydown.notjsFormInput",function(b){switch(b.keyCode){case Notjs.keyCode.ENTER:return a.args.commitChanges();case Notjs.keyCode.ESCAPE:return a.args.cancelChanges()}})};return c}.call(this)})}).call(this);
(function(){var a=function(a,c){return function(){return a.apply(c,arguments)}};Notjs.namespace("basics",function(d){return d.Partials=function(){function c(b){null==b&&(b={});this.onPartialsResolved=a(this.onPartialsResolved,this);this.onPartialRendered=a(this.onPartialRendered,this);this.renderPartial=a(this.renderPartial,this);this.fetchExternalPartial=a(this.fetchExternalPartial,this);this.resolveExternal=a(this.resolveExternal,this);this.resolveInPage=a(this.resolveInPage,this);this.resolve=
a(this.resolve,this);this.initialize=a(this.initialize,this);this.options=_.defaults(b,{removePartials:!0,hidePartials:!1,selector:"body",onPartialsResolved:null,onPartialRendered:null});this.inPagePartials={};this.outstandingExternalRequests=0}c.resolve=function(b){null==b&&(b={});return(new this(b)).initialize().resolve()};c.prototype.initialize=function(){var b;this.$el=$(this.options.selector);b=this.$el.find(".not-partial");this.inPagePartials=_.groupBy(b,"id");this.options.removePartials&&b.remove();
this.options.hidePartials&&b.hide();return this};c.prototype.resolve=function(b){var a=this;null==b&&(b={});b=_.defaults(b,{onPartialsResolved:null});this.resolveExternal({onComplete:function(){a.resolveInPage();return a.onPartialsResolved(b.onPartialsResolved)}});return this};c.prototype.resolveInPage=function(){var b,a,c,d,f,i,j;a=this.$el.find('[data-not_partial^="#"]');f=0;for(i=a.length;f<i;f++)b=a[f],b=$(b),c=b.attr("data-not_partial"),d=c.slice(1),(c=null!=(j=this.inPagePartials[d])?j[0]:void 0)?
this.renderPartial(b,$(c).html()):console.error("In page partial not found by id "+d+" for element: ");return this};c.prototype.resolveExternal=function(b){var a,c,d,f,i;null==b&&(b={});b=_.defaults(b,{onComplete:null});this.externalsRes;c=this.$el.find('[data-not_partial*="/"]');if(0>=c.length&&"function"===typeof b.onComplete)b.onComplete();f=0;for(i=c.length;f<i;f++)a=c[f],a=$(a),d=a.attr("data-not_partial"),this.fetchExternalPartial(a,d,b);return this};c.prototype.fetchExternalPartial=function(b,
a,c){var d=this;null==c&&(c={});c=_.defaults(c,{onComplete:null});if(!a.isBlank())return this.outstandingExternalRequests+=1,$.ajax(a,{dataType:"html",complete:function(){if(0>=(d.outstandingExternalRequests-=1))return"function"===typeof c.onComplete?c.onComplete():void 0},success:function(a){return d.renderPartial(b,a)},error:function(b,c,d){return console.log("Notjs.basics.Partial: Failed to fetch external partial at "+a+". "+("error: "+d+". status: "+status))}})};c.prototype.renderPartial=function(b,
a){b.html(a);return this.onPartialRendered(b)};c.prototype.onPartialRendered=function(b){var a;return"function"===typeof(a=this.options).onPartialRendered?a.onPartialRendered(b):void 0};c.prototype.onPartialsResolved=function(b){var a;return("function"===typeof b?b():void 0)||("function"===typeof(a=this.options).onPartialsResolved?a.onPartialsResolved():void 0)};return c}()})}).call(this);
(function(){var a=function(a,c){return function(){return a.apply(c,arguments)}};Notjs.namespace("basics",function(d){return d.Replicator=function(){function c(b,c){this.selector=b;null==c&&(c={});this.refresh=a(this.refresh,this);this.replicate=a(this.replicate,this);this.getTemplate=a(this.getTemplate,this);this.initialize=a(this.initialize,this);this.options=_.defaults(c,{data:null})}c.replicate=function(b,a,d){return(new c(b)).initialize().replicate(a,d)};c.prototype.initialize=function(){this.$element=
$(this.selector);this.getTemplate();return this};c.prototype.getTemplate=function(){if(this.$template)return this.$template;this.$template=this.$element.clone();this.$element.html("");return this.$template};c.prototype.replicate=function(b,a){var c,d,f,i,j;this.array=b;this.callback=a;this.$element.html("");f=i=0;for(j=b.length;i<j;f=++i)d=b[f],c=this.$template.clone(),(!a||a(c,d,f))&&this.$element.append(c);return this};c.prototype.refresh=function(){if(null!=this.array&&null!=this.callback)return this.replicate(this.array,
this.callback)};return c}.call(this)})}).call(this);
(function(){Notjs.addPrototypeUnlessExists(String,"startsWith",function(a){return this.slice(0,a.length)===a});Notjs.addPrototypeUnlessExists(String,"endsWith",function(a){return this.slice(-a.length)===str});Notjs.addPrototypeUnlessExists(String,"isBlank",function(){return""===this.trim()});Notjs.addPrototypeUnlessExists(String,"trim",function(){return this.replace(/^\s+|\s+$/g,"")});Notjs.addPrototypeUnlessExists(String,"elipsize",function(a){return this.length<=a?this:this.slice(0,a-3)+"..."});
Notjs.addPrototypeUnlessExists(String,"decamelize",function(){var a;a=this.replace(/([A-Z])/g," $1");return a.charAt(0).toUpperCase()+a.slice(1)});Notjs.addPrototypeUnlessExists(String,"dropCamelize",function(){var a;a=this.replace(/\s/g,"");return a.charAt(0).toLowerCase()+a.slice(1)})}).call(this);
(function(){Notjs.deepGet=function(a,d){var c,b,e,g,h;c=a;h=d.split(".");e=0;for(g=h.length;e<g;e++){b=h[e];if(null==c[b]){c=null;break}c=_.isFunction(c[b])?c[b]():c[b]}return c};Notjs.deepSet=function(a,d,c){var b,e,g,h;e=d.split(".");d=_.last(e);g=0;for(h=e.length;g<h;g++){b=e[g];if(null==a[b]){a=null;break}if(b===d)return _.isFunction(a[b])?a[b](c):a[b]=c}return a};Notjs.keyCode={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,
DELETE:46}}).call(this);
(function(){var a=function(a,c){return function(){return a.apply(c,arguments)}},d={}.hasOwnProperty,c=function(a,c){function g(){this.constructor=a}for(var h in c)d.call(c,h)&&(a[h]=c[h]);g.prototype=c.prototype;a.prototype=new g;a.__super__=c.prototype;return a};Notjs.namespace("basics.formInputs",function(b){return b.Checkbox=function(e){function d(b){this.serializeValue=a(this.serializeValue,this);this.loadValue=a(this.loadValue,this);this.initialize=a(this.initialize,this);d.__super__.constructor.apply(this,
arguments)}c(d,e);d.formatForDisplay=function(a,b,c){return c?"Yes":"No"};d.prototype.initialize=function(){return this.$input=$(b.Checkbox._renderInput(!1,!1)).appendTo(this.$element).focus().select()};d.prototype.loadValue=function(a){return this.getDataObjectValue(a)?this.$input.attr("checked","checked"):this.$input.removeAttr("checked")};d.prototype.serializeValue=function(){return"checked"===this.$input.attr("checked")};d._renderInput=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return"<input type='checkbox' "+
(b?"disabled='disabled'":"")+" "+(a?"checked='checked'":"")+"/>"};return d}.call(this,Notjs.basics.FormInput)})}).call(this);
(function(){var a=function(a,c){return function(){return a.apply(c,arguments)}},d={}.hasOwnProperty,c=function(a,c){function g(){this.constructor=a}for(var h in c)d.call(c,h)&&(a[h]=c[h]);g.prototype=c.prototype;a.prototype=new g;a.__super__=c.prototype;return a};Notjs.namespace("basics.formInputs",function(b){return b.Text=function(b){function d(c){this.serializeValue=a(this.serializeValue,this);this.loadValue=a(this.loadValue,this);this.destroy=a(this.destroy,this);this.initialize=a(this.initialize,
this);d.__super__.constructor.apply(this,arguments)}c(d,b);d.formatForDisplay=function(a,c,b){return null!=b?b.toString():void 0};d.prototype.initialize=function(){var a=this;this.$input=$("<INPUT type=text/>").appendTo(this.$element).on("keydown.nav",function(a){if(a.keyCode===Notjs.keyCode.LEFT||a.keyCode===Notjs.keyCode.RIGHT)return a.stopImmediatePropagation()});_.defer(function(){return a.$input.focus().select()});return this.$input};d.prototype.destroy=function(){return this.$input.remove()};
d.prototype.loadValue=function(a){return this.$input.val(this.getDataObjectValue(a))};d.prototype.serializeValue=function(){return this.$input.val()};return d}.call(this,Notjs.basics.FormInput)})}).call(this);
