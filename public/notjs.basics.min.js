(function(){var a,g,c=function(b,e){return function(){return b.apply(e,arguments)}},b=[].slice;g="undefined"!==typeof module&&module.exports?global:window;a=function(){function d(){this.globalNamespace=c(this.globalNamespace,this)}d.prototype.namespace=function(d,a,c){var h,g,j,l,k;3>arguments.length&&(h=[this].concat(b.call(arguments)),d=h[0],a=h[1],c=h[2]);g=d;k=a.split(".");j=0;for(l=k.length;j<l;j++)h=k[j],d=d[h]||(d[h]={});return c(d,g)};d.prototype.globalNamespace=function(){return g};d.prototype.addPrototypeUnlessExists=
function(b,d,a){return b.prototype[d]||(b.prototype[d]=a)};d.prototype.errors={pureVirtualMissing:function(b,d){throw""+b+" pure virtual method "+d+" missing. Must override in subclass of FormInput.";},invalidArgument:function(b){throw"Invalid Argument: "+b;}};return d}.call(this);g.Notjs=new a}).call(this);(function(){Notjs.addPrototypeUnlessExists(Array,"remove",function(a,g){var c;c=this.slice((g||a)+1||this.length);this.length=0>a?this.length+a:a;return this.push.apply(this,c)})}).call(this);
(function(){var a=function(a,c){return function(){return a.apply(c,arguments)}};Notjs.namespace("basics",function(g){return g.Form=function(){function c(b,d,e){this.selector=b;this.dataObject=d;null==e&&(e={});this._cancelChanges=a(this._cancelChanges,this);this._commitChanges=a(this._commitChanges,this);this._getClassFor=a(this._getClassFor,this);this._defaultUpdateCallback=a(this._defaultUpdateCallback,this);this._startInlineEdit=a(this._startInlineEdit,this);this._findCancelButtons=a(this._findCancelButtons,
this);this._findSaveButtons=a(this._findSaveButtons,this);this._hideSaveAndCancel=a(this._hideSaveAndCancel,this);this._showSaveAndCancel=a(this._showSaveAndCancel,this);this._displayDataFor=a(this._displayDataFor,this);this._displayDataForAll=a(this._displayDataForAll,this);this._instantiateFormInputFor=a(this._instantiateFormInputFor,this);this._showInputFor=a(this._showInputFor,this);this._showAllInputs=a(this._showAllInputs,this);this._editOnClick=a(this._editOnClick,this);this._installClickHandlers=
a(this._installClickHandlers,this);this._initializeFormInputs=a(this._initializeFormInputs,this);this.setFormMode=a(this.setFormMode,this);this.refresh=a(this.refresh,this);this.initialize=a(this.initialize,this);this.options=_.defaults(e,{formMode:"fullInput",updateCallback:this._defaultUpdateCallback});this.formInputs=[];return this}c.prototype.initialize=function(){this.$element=$(this.selector);this._initializeFormInputs();this.setFormMode(this.options.formMode);return this};c.prototype.refresh=
function(){return this.setFormMode(this.options.formMode)};c.prototype.setFormMode=function(b){this.$element.hasClass("readonly")&&(b="readOnly");this.options.formMode=b;this.inlineEditing=!1;switch(b){case "fullInput":return this._showAllInputs(),this._showSaveAndCancel();case "inlineEdit":case "switchToFullInput":return this._displayDataForAll(),this._installClickHandlers(),this._hideSaveAndCancel();case "readOnly":return this._displayDataForAll(),this._hideSaveAndCancel();default:return Notjs.errors.invalidArgument("formMode")}};
c.prototype._initializeFormInputs=function(){var b,d,a,c,f,h;this.formInputs=[];f=this.$element.find("[data-not_attr]");h=[];a=0;for(c=f.length;a<c;a++)b=f[a],b=$(b),d=b.data("not_type")||"Text",h.push(this.formInputs.push({$element:b,type:d,attr:b.data("not_attr"),formInputClass:this._getClassFor(d),formInputObject:null}));return h};c.prototype._installClickHandlers=function(){var b,d,a,c,f,h=this;c=this.formInputs;f=[];d=0;for(a=c.length;d<a;d++)b=c[d],f.push(b.$element.click(function(){return h._editOnClick(b)}));
return f};c.prototype._editOnClick=function(b){"switchToFullInput"===this.options.formMode?this._showAllInputs():this._startInlineEdit(b);return b.$element.focus().select()};c.prototype._showAllInputs=function(){var b,d,a,c,f;c=this.formInputs;f=[];d=0;for(a=c.length;d<a;d++)b=c[d],f.push(this._showInputFor(b));return f};c.prototype._showInputFor=function(b){if(b.$element.hasClass("readonly"))return this._displayDataFor(b);b.formInputObject||(b.formInputObject=this._instantiateFormInputFor(b));return b.formInputObject.loadValue(this.dataObject)};
c.prototype._instantiateFormInputFor=function(b){return new b.formInputClass({container:b.$element,column:{field:b.attr},grid:this,gridPosition:0,position:0,item:dataObject,cancelChanges:this._cancelChanges,commitChanges:this._commitChanges})};c.prototype._displayDataForAll=function(){var b,d,a,c,f;c=this.formInputs;f=[];d=0;for(a=c.length;d<a;d++)b=c[d],f.push(this._displayDataFor(b));return f};c.prototype._displayDataFor=function(b){var d,a,c;d=b.$element;c=b.formInputClass;a=b.attr;if(null!=c.formatForDisplay&&
_.isFunction(c.formatForDisplay))return d.html(c.formatForDisplay(d,d,this.dataObject[a],null,this.dataObject));console.warn("FormInput type "+b.type+" for "+a+" doesn't have a formatForDisplay class method. skipping")};c.prototype._showSaveAndCancel=function(){this._findSaveButtons().removeClass("hidden").on("click.notjs-form",this._commitChanges);return this._findCancelButtons().removeClass("hidden").on("click.notjs-form",this._cancelChanges)};c.prototype._hideSaveAndCancel=function(){this._findSaveButtons().addClass("hidden").off("click.notjs-form");
return this._findCancelButtons().addClass("hidden").off("click.notjs-form")};c.prototype._findSaveButtons=function(){return this.$element.find("input[type='submit'], .success")};c.prototype._findCancelButtons=function(){return this.$element.find(".cancel")};c.prototype._startInlineEdit=function(b){this._showInputFor(b);this._showSaveAndCancel();return this.inlineEditing=b};c.prototype._defaultUpdateCallback=function(){};c.prototype._getClassFor=function(b){var d,a,c,f,h;if(Notjs.basics.formInputs[b])return Notjs.basics.formInputs[b];
d=Notjs.globalNamespace();h=b.split(".");c=0;for(f=h.length;c<f;c++)if(a=h[c],d[a])d=d[a];else throw"Unable to find class for FormInput type "+b+", specifically "+a;return d};c.prototype._commitChanges=function(){var b,d,a,c,f;this.inlineEditing?(d=[this.inlineEditing],this.inlineEditing=!1):d=this.formInputs;a=[];c=0;for(f=d.length;c<f;c++)b=d[c],null!=b.formInputObject&&(b.formInputObject.applyValue(dataObject,b.formInputObject.serializeValue()),a.push(b.attr));return this.options.updateCallback(a)};
c.prototype._cancelChanges=function(){this.inlineEditing=!1;return this.refresh()};return c}()})}).call(this);
(function(){var a=function(a,c){return function(){return a.apply(c,arguments)}};Notjs.namespace("basics",function(g){return g.FormInput=function(){function c(b){this.args=b;this.setDataObjectValue=a(this.setDataObjectValue,this);this.getDataObjectValue=a(this.getDataObjectValue,this);this.focus=a(this.focus,this);this.destroy=a(this.destroy,this);this.applyValue=a(this.applyValue,this);this.serializeValue=a(this.serializeValue,this);this.loadValue=a(this.loadValue,this);this.initialize=a(this.initialize,
this);this.$element=this.args.container;this.attr=this.args.column.field;this.options=this.args.column;return this.initialize()}c.formatForDisplay=function(){return Notjs.errors.pureVirtualMissing("FormInput","@formatForDisplay")};c.prototype.initialize=function(){return Notjs.errors.pureVirtualMissing("FormInput","initialize")};c.prototype.loadValue=function(){return Notjs.errors.pureVirtualMissing("FormInput","loadValue")};c.prototype.serializeValue=function(){return Notjs.errors.pureVirtualMissing("FormInput",
"serializeValue")};c.prototype.applyValue=function(b,d){return this.setDataObjectValue(b,d)};c.prototype.destroy=function(){return this.$element.html("")};c.prototype.focus=function(){return this.$element.focus()};c.prototype.getDataObjectValue=function(b){return Notjs.deepGet(b,this.attr)||""};c.prototype.setDataObjectValue=function(b,d){return Notjs.deepSet(b,this.attr,d)};return c}.call(this)})}).call(this);
(function(){var a=function(a,c){return function(){return a.apply(c,arguments)}};Notjs.namespace("basics",function(g){return g.Partials=function(){function c(b){null==b&&(b={});this.onPartialsResolved=a(this.onPartialsResolved,this);this.onPartialRendered=a(this.onPartialRendered,this);this.renderPartial=a(this.renderPartial,this);this.fetchExternalPartial=a(this.fetchExternalPartial,this);this.resolveExternal=a(this.resolveExternal,this);this.resolveInPage=a(this.resolveInPage,this);this.resolve=
a(this.resolve,this);this.initialize=a(this.initialize,this);this.options=_.defaults(b,{removePartials:!0,hidePartials:!1,selector:"body",onPartialsResolved:null,onPartialRendered:null});this.inPagePartials={};this.outstandingExternalRequests=0}c.resolve=function(b){null==b&&(b={});return(new this(b)).initialize().resolve()};c.prototype.initialize=function(){var b;this.$el=$(this.options.selector);b=this.$el.find(".not-partial");this.inPagePartials=_.groupBy(b,"id");this.options.removePartials&&b.remove();
this.options.hidePartials&&b.hide();return this};c.prototype.resolve=function(b){var d=this;null==b&&(b={});b=_.defaults(b,{onPartialsResolved:null});this.resolveExternal({onComplete:function(){d.resolveInPage();return d.onPartialsResolved(b.onPartialsResolved)}});return this};c.prototype.resolveInPage=function(){var b,d,a,c,f,h,g;d=this.$el.find('[data-not_partial^="#"]');f=0;for(h=d.length;f<h;f++)b=d[f],b=$(b),a=b.attr("data-not_partial"),c=a.slice(1),(a=null!=(g=this.inPagePartials[c])?g[0]:void 0)?
this.renderPartial(b,$(a).html()):console.error("In page partial not found by id "+c+" for element: ");return this};c.prototype.resolveExternal=function(b){var a,c,i,f,h;null==b&&(b={});b=_.defaults(b,{onComplete:null});this.externalsRes;c=this.$el.find('[data-not_partial*="/"]');if(0>=c.length&&"function"===typeof b.onComplete)b.onComplete();f=0;for(h=c.length;f<h;f++)a=c[f],a=$(a),i=a.attr("data-not_partial"),this.fetchExternalPartial(a,i,b);return this};c.prototype.fetchExternalPartial=function(b,
a,c){var i=this;null==c&&(c={});c=_.defaults(c,{onComplete:null});if(!a.isBlank())return this.outstandingExternalRequests+=1,$.ajax(a,{dataType:"html",complete:function(){if(0>=(i.outstandingExternalRequests-=1))return"function"===typeof c.onComplete?c.onComplete():void 0},success:function(a){return i.renderPartial(b,a)},error:function(b,c,e){return console.log("Notjs.basics.Partial: Failed to fetch external partial at "+a+". "+("error: "+e+". status: "+status))}})};c.prototype.renderPartial=function(b,
a){b.html(a);return this.onPartialRendered(b)};c.prototype.onPartialRendered=function(b){var a;return"function"===typeof(a=this.options).onPartialRendered?a.onPartialRendered(b):void 0};c.prototype.onPartialsResolved=function(b){var a;return("function"===typeof b?b():void 0)||("function"===typeof(a=this.options).onPartialsResolved?a.onPartialsResolved():void 0)};return c}()})}).call(this);
(function(){var a=function(a,c){return function(){return a.apply(c,arguments)}};Notjs.namespace("basics",function(g){return g.Replicator=function(){function c(b,c){this.selector=b;null==c&&(c={});this.replicate=a(this.replicate,this);this.getTemplate=a(this.getTemplate,this);this.initialize=a(this.initialize,this);this.options=_.defaults(c,{data:null})}c.replicate=function(b,a,e){return(new c(b)).initialize().replicate(a,e)};c.prototype.initialize=function(){this.$element=$(this.selector);this.getTemplate();
return this};c.prototype.getTemplate=function(){if(this.$template)return this.$template;this.$template=this.$element.clone();this.$element.html("");return this.$template};c.prototype.replicate=function(b,a){var c,i,f,h,g;this.$element.html("");f=h=0;for(g=b.length;h<g;f=++h)i=b[f],c=this.$template.clone(),(!a||a(c,i,f))&&this.$element.append(c);return this};return c}.call(this)})}).call(this);
(function(){Notjs.addPrototypeUnlessExists(String,"startsWith",function(a){return this.slice(0,a.length)===a});Notjs.addPrototypeUnlessExists(String,"endsWith",function(a){return this.slice(-a.length)===str});Notjs.addPrototypeUnlessExists(String,"isBlank",function(){return""===this.trim()});Notjs.addPrototypeUnlessExists(String,"trim",function(){return this.replace(/^\s+|\s+$/g,"")});Notjs.addPrototypeUnlessExists(String,"elipsize",function(a){return this.length<=a?this:this.slice(0,a-3)+"..."});
Notjs.addPrototypeUnlessExists(String,"decamelize",function(){var a;a=this.replace(/([A-Z])/g," $1");return a.charAt(0).toUpperCase()+a.slice(1)});Notjs.addPrototypeUnlessExists(String,"dropCamelize",function(){var a;a=this.replace(/\s/g,"");return a.charAt(0).toLowerCase()+a.slice(1)})}).call(this);
(function(){Notjs.deepGet=function(a,g){var c,b,d,e,i;c=a;i=g.split(".");d=0;for(e=i.length;d<e;d++){b=i[d];if(null==c[b]){c=null;break}c=_.isFunction(c[b])?c[b]():c[b]}return c};Notjs.deepSet=function(a,g,c){var b,d,e,i;d=g.split(".");g=_.last(d);e=0;for(i=d.length;e<i;e++){b=d[e];if(null==a[b]){a=null;break}if(b===g)return _.isFunction(a[b])?a[b](c):a[b]=c}return a};Notjs.keyCode={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,
DELETE:46}}).call(this);
(function(){var a=function(b,a){return function(){return b.apply(a,arguments)}},g={}.hasOwnProperty,c=function(b,a){function c(){this.constructor=b}for(var i in a)g.call(a,i)&&(b[i]=a[i]);c.prototype=a.prototype;b.prototype=new c;b.__super__=a.prototype;return b};Notjs.namespace("basics.formInputs",function(b){return b.Checkbox=function(d){function e(b){this.serializeValue=a(this.serializeValue,this);this.loadValue=a(this.loadValue,this);this.initialize=a(this.initialize,this);e.__super__.constructor.apply(this,
arguments)}c(e,d);e.formatForDisplay=function(a,b,c){return e._renderInput(c,!0)};e.prototype.initialize=function(){return this.$input=$(b.Checkbox._renderInput(!1,!1)).appendTo(this.$element).focus().select()};e.prototype.loadValue=function(a){return this.getDataObjectValue(a)?this.$input.attr("checked","checked"):this.$input.removeAttr("checked")};e.prototype.serializeValue=function(){return"checked"===this.$input.attr("checked")};e._renderInput=function(a,b){null==a&&(a=!1);null==b&&(b=!1);return"<input type='checkbox' "+
(b?"disabled='disabled'":"")+" "+(a?"checked='checked'":"")+"/>"};return e}.call(this,Notjs.basics.FormInput)})}).call(this);
(function(){var a=function(a,c){return function(){return a.apply(c,arguments)}},g={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var i in c)g.call(c,i)&&(a[i]=c[i]);e.prototype=c.prototype;a.prototype=new e;a.__super__=c.prototype;return a};Notjs.namespace("basics.formInputs",function(b){return b.Text=function(b){function e(b){this.serializeValue=a(this.serializeValue,this);this.loadValue=a(this.loadValue,this);this.initialize=a(this.initialize,this);e.__super__.constructor.apply(this,
arguments)}c(e,b);e.formatForDisplay=function(a,b,c){return null!=c?c.toString():void 0};e.prototype.initialize=function(){return this.$input=$("<INPUT type=text/>").appendTo(this.$element).bind("keydown.nav",function(a){if(a.keyCode===Notjs.keyCode.LEFT||a.keyCode===Notjs.keyCode.RIGHT)return a.stopImmediatePropagation()}).focus().select()};e.prototype.loadValue=function(a){return this.$input.val(this.getDataObjectValue(a))};e.prototype.serializeValue=function(){return this.$input.val()};return e}.call(this,
Notjs.basics.FormInput)})}).call(this);
